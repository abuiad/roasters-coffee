<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>محامص القهوة المختصة</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 font-sans">

  <!-- الهيدر -->
  <header class="bg-white shadow mb-6 p-6 text-center">
    <h1 class="text-3xl font-bold text-gray-800">☕ محامص القهوة المختصة</h1>
    <p class="text-gray-500">استكشف - قيّم - أضف محمصتك المفضلة</p>
  </header>

  <!-- الأدوات -->
  <section class="max-w-6xl mx-auto px-4 mb-6 flex flex-col md:flex-row items-center justify-between gap-3">
    <input id="search" type="text" placeholder="🔎 ابحث بالاسم أو المدينة" 
           class="border p-2 rounded-lg w-full md:w-1/3">

    <select id="sort" class="border p-2 rounded-lg">
      <option value="">بدون ترتيب</option>
      <option value="name">الاسم (أبجدي)</option>
      <option value="city">المدينة</option>
    </select>

    <select id="filterRating" class="border p-2 rounded-lg">
      <option value="0">كل التقييمات</option>
      <option value="4">4 ⭐ فما فوق</option>
      <option value="5">5 ⭐ فقط</option>
    </select>

    <div class="flex gap-2">
      <button id="filterAll" class="bg-gray-200 px-3 py-1 rounded">الكل</button>
      <button id="filterFav" class="bg-red-200 px-3 py-1 rounded">المفضلة ❤️</button>
    </div>
  </section>

  <!-- لوحة الإحصائيات -->
  <section id="dashboard" class="max-w-6xl mx-auto px-4 mb-6 grid grid-cols-1 md:grid-cols-3 gap-4">
    <div class="bg-white shadow rounded-lg p-4 text-center">
      <h3 class="text-lg font-semibold text-gray-700">إجمالي المحامص</h3>
      <p id="totalCount" class="text-2xl font-bold text-blue-600">0</p>
    </div>
    <div class="bg-white shadow rounded-lg p-4 text-center">
      <h3 class="text-lg font-semibold text-gray-700">المفضلة ❤️</h3>
      <p id="favCount" class="text-2xl font-bold text-pink-600">0</p>
    </div>
    <div class="bg-white shadow rounded-lg p-4 text-center">
      <h3 class="text-lg font-semibold text-gray-700">أعلى تقييم ⭐</h3>
      <p id="topRating" class="text-2xl font-bold text-yellow-500">0 ⭐</p>
    </div>
  </section>

  <!-- البطاقات -->
  <main id="roastersList" class="grid gap-6 grid-cols-1 md:grid-cols-2 lg:grid-cols-3 max-w-6xl mx-auto px-4">
    <!-- يتم حقن البطاقات هنا -->
  </main>

  <!-- نموذج الإضافة -->
  <footer class="bg-white mt-10 shadow-inner p-6">
    <h2 class="text-xl font-semibold mb-4 text-gray-700">➕ إضافة محمصة جديدة</h2>
    <form id="roasterForm" class="grid gap-3 md:grid-cols-2">
      <input type="text" id="name" placeholder="اسم المحمصة" class="border p-2 rounded" required>
      <input type="text" id="city" placeholder="المدينة" class="border p-2 rounded" required>
      <input type="url" id="website" placeholder="رابط الموقع" class="border p-2 rounded" required>
      <input type="file" id="logo" accept="image/*" class="border p-2 rounded">
      <button type="submit" class="bg-green-500 text-white py-2 px-4 rounded hover:bg-green-600 md:col-span-2">
        إضافة
      </button>
    </form>
  </footer>

<script>
let roasters = JSON.parse(localStorage.getItem("roasters")) || [
  {id:1,name:"محماص الرياض",city:"الرياض",website:"https://example.com",logo:"",rating:4,favorite:false},
  {id:2,name:"بن جدة",city:"جدة",website:"https://example.com",logo:"",rating:5,favorite:true}
];
let showFavoritesOnly = false;

function saveData(){ localStorage.setItem("roasters", JSON.stringify(roasters)); }

function renderCard(r){
  const card=document.createElement("div");
  card.id="card-"+r.id;
  card.className="bg-white shadow rounded-lg p-4 flex flex-col items-center text-center";

  card.innerHTML=`
    <img src="${r.logo||'https://via.placeholder.com/100'}" class="w-24 h-24 object-cover rounded-full mb-2">
    <h3 class="text-lg font-bold">${r.name}</h3>
    <p class="text-gray-500">${r.city}</p>
    <button onclick="window.open('${r.website}','_blank')" 
      class="bg-blue-500 text-white px-3 py-1 mt-2 rounded hover:bg-blue-600">
      🌐 زيارة الموقع
    </button>
    <div class="stars flex gap-1 mt-2"></div>
    <div class="flex gap-2 mt-3">
      <button onclick="toggleFav(${r.id})" class="px-2 py-1 bg-pink-200 rounded text-sm">${r.favorite?"💖":"🤍"}</button>
      <button onclick="editRoaster(${r.id})" class="px-2 py-1 bg-yellow-200 rounded text-sm">✏️</button>
      <button onclick="deleteRoaster(${r.id})" class="px-2 py-1 bg-red-200 rounded text-sm">🗑️</button>
    </div>
  `;

  // النجوم
  const starsDiv = card.querySelector(".stars");
  for(let i=1;i<=5;i++){
    const s=document.createElement("span");
    s.textContent=i<=r.rating?"⭐":"☆";
    s.className="cursor-pointer text-xl";
    s.onclick=()=>{ r.rating=i; saveData(); renderRoasters(); };
    starsDiv.appendChild(s);
  }

  return card;
}

function renderRoasters(){
  const list=document.getElementById("roastersList");
  list.innerHTML="";
  let filtered=roasters;

  const q=document.getElementById("search").value.toLowerCase();
  if(q) filtered=filtered.filter(r=>r.name.toLowerCase().includes(q)||r.city.toLowerCase().includes(q));

  if(showFavoritesOnly) filtered=filtered.filter(r=>r.favorite);

  const sort=document.getElementById("sort").value;
  if(sort) filtered=filtered.sort((a,b)=>a[sort].localeCompare(b[sort]));

  const minRating=parseInt(document.getElementById("filterRating").value);
  if(minRating>0) filtered=filtered.filter(r=>r.rating>=minRating);

  filtered.forEach(r=>list.appendChild(renderCard(r)));
  updateDashboard();
}

function addRoaster(e){
  e.preventDefault();
  const id=Date.now();
  const name=document.getElementById("name").value;
  const city=document.getElementById("city").value;
  const website=document.getElementById("website").value;
  const logoInput=document.getElementById("logo");

  let logo="";
  if(logoInput.files[0]){
    const reader=new FileReader();
    reader.onload=function(ev){
      logo=ev.target.result;
      roasters.push({id,name,city,website,logo,rating:0,favorite:false});
      saveData(); renderRoasters();
    };
    reader.readAsDataURL(logoInput.files[0]);
  }else{
    roasters.push({id,name,city,website,logo,rating:0,favorite:false});
    saveData(); renderRoasters();
  }
  e.target.reset();
}

function toggleFav(id){
  const r=roasters.find(x=>x.id===id); if(!r) return;
  r.favorite=!r.favorite; saveData(); renderRoasters();
}

function deleteRoaster(id){
  if(!confirm("هل تريد حذف هذه المحمصة؟")) return;
  roasters=roasters.filter(r=>r.id!==id);
  saveData(); renderRoasters();
}

function editRoaster(id){
  const r=roasters.find(x=>x.id===id); if(!r) return;
  document.getElementById("name").value=r.name;
  document.getElementById("city").value=r.city;
  document.getElementById("website").value=r.website;
  deleteRoaster(id);
  window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"});
}

function updateDashboard(){
  document.getElementById("totalCount").textContent = roasters.length;
  document.getElementById("favCount").textContent = roasters.filter(r=>r.favorite).length;
  const top = roasters.length ? Math.max(...roasters.map(r=>r.rating)) : 0;
  document.getElementById("topRating").textContent = top + " ⭐";
}

document.getElementById("roasterForm").onsubmit=addRoaster;
document.getElementById("search").oninput=renderRoasters;
document.getElementById("sort").onchange=renderRoasters;
document.getElementById("filterRating").onchange=renderRoasters;
document.getElementById("filterAll").onclick=()=>{showFavoritesOnly=false;renderRoasters();};
document.getElementById("filterFav").onclick=()=>{showFavoritesOnly=true;renderRoasters();};

renderRoasters();
